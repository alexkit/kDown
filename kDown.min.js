/*!
 * kDown 2.0.0
 * @author Alex Duloz ~ @alexduloz
 * MIT license
 *
 * Documentation intended for Closure Compiler
 * https://developers.google.com/closure/compiler/docs/js-for-compiler
 */
(function(){if(!window.addEventListener){return}if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}var e=blueprint={_:function(){this._ignoreInput=false;this._cmdOrCtrl=true;this._logKeyCodes=false;this._preventDefault=true;this._always=[];this._currentMethod;this._whenDownKeys=[];this._whenDownCallback=[];this._whenDownContext=[];this._whenDownCondition=[];this._whenDownKey=[];this._whenShortcutKeys=[];this._whenShortcutCallback=[];this._whenShortcutContext=[];this._whenShortcutCondition=[];this._whenShortcutKey=[];this._whenXpressKeys=[];this._whenXpressCallback=[];this._whenXpressDefaultN=2;this._whenXpressN=[];this._whenXpressContext=[];this._whenXpressDefaultMilliseconds=220;this._whenXpressMilliseconds=[];this._whenXpressListening=[];this._whenXpressTrigger=[];this._whenXpressCondition=[];this._whenXpressKey=[];this._whenXpressStrictOrLoose=[];this._whenXpressDefaultStrictOrLoose="strict";this._event;this._down={};this._count=0;this._keysAsString=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12","left","up","right","down","arrayleft","arrayup","arrayright","arraydown","alt","altkey","ctrl","ctrlkey","shift","shiftkey","meta","metakey","cmd","cmdkey","backspace","del","delete","end","enter","escape","esc","home","insert","pageup","pagedown","tab","space"];this._keysAsStringLength=this._keysAsString.length;this._keysAsKeyCode=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,48,49,50,51,52,53,54,55,56,57,112,113,114,115,116,117,118,119,120,121,122,123,37,38,39,40,37,38,39,40,18,18,17,17,16,16,[224,17,91,93],[224,17,91,93],[224,17,91,93],[224,17,91,93],8,8,46,35,13,27,27,36,45,33,34,9,32];this._keysAsKeyCodeLength=this._keysAsKeyCode.length;this._keyUpHandler=function(t){if(e._ignoreInput===true){if(t.target.tagName==="INPUT"||t.target.tagName==="TEXTAREA"){return}}e._event=t;if(t.metaKey){e._down={};e._count=0;return}delete e._down[t.which];e._count--;if(e._count<0){e._count=0}};this._keyDownHandler=function(t){if(e._logKeyCodes===true){console.log(t.which)}if(e._ignoreInput===true){if(t.target.tagName==="INPUT"||t.target.tagName==="TEXTAREA"){return}}e._event=t;var n=e._whenShortcutKeys.length;if(n>0){for(var r=0;r<n;r++){if(e.isShortcut(e._whenShortcutKeys[r])){var i=true;if(e._whenShortcutContext[r]){var s=e._whenShortcutContext[r].length;i=false;for(var o=0;o<s;o++){if(!!(e._whenShortcutContext[r][o]&&e._whenShortcutContext[r][o].nodeType===1)){if(t.target.getAttribute("data-whenshortcut-context-"+r)===null||+t.target.getAttribute("data-whenshortcut-context-"+r)!==o){if(i===true){continue}}else{i=true}}}}if(e._whenShortcutCondition[r]){if(!e._whenShortcutCondition[r](e._event)){i=false}}if(i===true){if(e.isFunction(e._whenShortcutCallback[r])){e._whenShortcutCallback[r](e._event);for(var o=0;o<e._always.length;o++){e._always[o](e._whenShortcutKeys[r])}}}}}}var u=e._whenXpressKeys.length;if(u>0){for(var r=0;r<u;r++){if(e.isShortcut(e._whenXpressKeys[r])){e._whenXpressTrigger[r](r,function(n){var r=true;if(e._whenXpressContext[n]){var i=e._whenXpressContext[n].length;r=false;for(var s=0;s<i;s++){if(!!(e._whenXpressContext[n][s]&&e._whenXpressContext[n][s].nodeType===1)){if(t.target.getAttribute("data-whenxpress-context-"+n)===null||+t.target.getAttribute("data-whenxpress-context-"+n)!==s){if(r===true){continue}}else{r=true}}}}if(e._whenXpressCondition[n]){if(!e._whenXpressCondition[n](e._event)){r=false}}if(r===true){if(e.isFunction(e._whenXpressCallback[n])){e._whenXpressCallback[n](e._event);for(var s=0;s<e._always.length;s++){e._always[s](e._whenXpressKeys[n])}}}})}}}if(t.metaKey){e._down={};e._count=0;return}if(!e._down[t.which]){e._count++}e._down[t.which]=true;var a=e._whenDownKeys.length;if(a>0){for(var r=0;r<a;r++){if(e.isDown(e._whenDownKeys[r])){var i=true;if(e._whenDownContext[r]){var s=e._whenDownContext[r].length;i=false;for(var o=0;o<s;o++){if(!!(e._whenDownContext[r][o]&&e._whenDownContext[r][o].nodeType===1)){if(t.target.getAttribute("data-whendown-context-"+r)===null||+t.target.getAttribute("data-whendown-context-"+r)!==o){if(i===true){continue}}else{i=true}}}}if(e._whenDownCondition[r]){if(!e._whenDownCondition[r](e._event)){i=false}}if(i===true){if(e.isFunction(e._whenDownCallback[r])){e._whenDownCallback[r](e._event);for(var o=0;o<e._always.length;o++){e._always[o](e._whenDownKeys[r])}}}}}}};return this},ignoreInput:function(e){this._ignoreInput=!this.isBool(e)?false:e;return this},cmdOrCtrl:function(e){this._cmdOrCtrl=!this.isBool(e)?true:e;return this},logKeyCodes:function(e){this._logKeyCodes=!this.isBool(e)?false:e;return this},preventDefault:function(e){this._preventDefault=!this.isBool(e)?true:e;return this},config:function(e){if(!this.isObject(e)){return}if(this.isBool(e.ignoreInput)){this._ignoreInput=e.ignoreInput}if(this.isBool(e.cmdOrCtrl)){this._cmdOrCtrl=e.cmdOrCtrl}if(this.isBool(e.logKeyCodes)){this._logKeyCodes=e.logKeyCodes}if(this.isBool(e.preventDefault)){this._preventDefault=e.preventDefault}return this},listen:function(t){t.addEventListener("keyup",e._keyUpHandler,true);t.addEventListener("keydown",e._keyDownHandler,true);return this},remove:function(t){t.removeEventListener("keyup",e._keyUpHandler,true);t.removeEventListener("keydown",e._keyDownHandler,true);return this},isShortcut:function(t,n){var n=n||e._event,r=this.format(t);if(e.isUndefined(n)){return false}var i=r.length;if(i===0){return false}var s=0;var o=[];for(var u=0;u<i;u++){if(r[u]===16&&n.shiftKey){s++}else if(r[u]===18&&n.altKey){s++}else if(e._cmdOrCtrl===true&&(r[u]===17||this.isArray(r[u])&&r[u].toString()===[224,17,91,93].toString())){if(n.metaKey||n.ctrlKey){s++}}else if(e._cmdOrCtrl===false&&r[u]===17){if(n.ctrlKey){s++}}else if(e._cmdOrCtrl===false&&this.isArray(r[u])&&r[u].toString()===[224,17,91,93].toString()){if(n.metaKey){s++}}else if(n.which===r[u]||this.isArray(r[u])&&r[u].indexOf(n.which)!==-1){s++}}return s===i},whenShortcut:function(t,n){e._currentMethod="whenShortcut";if(!n){e.shut("whenShortcut",t)}this._whenShortcutKeys.push(t);this._whenShortcutCallback.push(n);this._whenShortcutCondition.push(null);this._whenShortcutKey.push(null);this._whenShortcutContext.push(null);return this},isDown:function(t,n,r){var n=n||e._event;var i=this.format(t);var s=0,o=0,u=i.length;for(var a in e._down){if(e._down.hasOwnProperty(a)){for(var f=0;f<=u;f++){if(this.isArray(i[f])){if(i[f].indexOf(+a)!==-1){o++}}else if(i[f]===+a){o++}}s++}}if(s===o&&u===o){if(this._preventDefault===true){n.preventDefault}return true}return false},whenDown:function(t,n,r){e._currentMethod="whenDown";if(!n){e.shut("whenDown",t)}this._whenDownKeys.push(t);this._whenDownCallback.push(n);this._whenDownCondition.push(null);this._whenDownKey.push(null);this._whenDownContext.push(null);return this},whenXpress:function(t,n,r,i,s){e._currentMethod="whenXpress";if(!n){e.shut("whenXpress",t)}r=r||e._whenXpressDefaultN;i=i||e._whenXpressDefaultMilliseconds;s=s||e._whenXpressDefaultStrictOrLoose;this._whenXpressKeys.push(t);this._whenXpressN.push(r);this._whenXpressCallback.push(n);this._whenXpressMilliseconds.push(i);this._whenXpressStrictOrLoose.push(s);this._whenXpressListening.push(false);this._whenXpressCondition.push(null);this._whenXpressKey.push(null);this._whenXpressContext.push(null);this._whenXpressTrigger.push(function(t,n){if(e._whenXpressListening[t]===false){e._whenXpressListening[t]=1;setTimeout(function(){if(e._whenXpressStrictOrLoose[t]==="strict"){if(e._whenXpressN[t]===e._whenXpressListening[t]){n(t)}}if(e._whenXpressStrictOrLoose[t]==="loose"){if(e._whenXpressN[t]<=e._whenXpressListening[t]){n(t)}}e._whenXpressListening[t]=false},e._whenXpressMilliseconds[t])}else{e._whenXpressListening[t]++}});return this},always:function(t){e._always.push(t);return this},context:function(t){if(!e._currentMethod){return}if(e._currentMethod==="whenDown"){var t=toString.call(t)!=="[object HTMLCollection]"?new Array(t):t;var n=e._whenDownKeys.length-1;var r=t.length;for(var i=0;i<r;i++){if(!!(t[i]&&t[i].nodeType===1)){t[i].setAttribute("data-whendown-context-"+n,i)}}e._whenDownContext[n]=t}if(e._currentMethod==="whenShortcut"){var t=toString.call(t)!=="[object HTMLCollection]"?new Array(t):t;var n=e._whenShortcutKeys.length-1;var r=t.length;for(var i=0;i<r;i++){if(!!(t[i]&&t[i].nodeType===1)){t[i].setAttribute("data-whenshortcut-context-"+n,i)}}e._whenShortcutContext[n]=t}if(e._currentMethod==="whenXpress"){var t=toString.call(t)!=="[object HTMLCollection]"?new Array(t):t;var n=e._whenXpressKeys.length-1;var r=t.length;for(var i=0;i<r;i++){if(!!(t[i]&&t[i].nodeType===1)){t[i].setAttribute("data-whenxpress-context-"+n,i)}}e._whenXpressContext[n]=t}return this},condition:function(t){if(!e._currentMethod){return}if(e._currentMethod==="whenDown"){var n=e._whenDownKeys.length-1;e._whenDownCondition[n]=t}if(e._currentMethod==="whenShortcut"){var n=e._whenShortcutKeys.length-1;e._whenShortcutCondition[n]=t}if(e._currentMethod==="whenXpress"){var n=e._whenXpressKeys.length-1;e._whenXpressCondition[n]=t}return this},key:function(t){if(!e._currentMethod){return}if(e._currentMethod==="whenDown"){var n=e._whenDownKeys.length-1;e._whenDownKey[n]=t}if(e._currentMethod==="whenShortcut"){var n=e._whenShortcutKeys.length-1;e._whenShortcutKey[n]=t}if(e._currentMethod==="whenXpress"){var n=e._whenXpressKeys.length-1;e._whenXpressKey[n]=t}return this},shut:function(t,n,r){if(!t){for(var i=0;i<e._whenDownKeys.length;i++){e._shutMethod("whenDown",i)}for(var i=0;i<e._whenShortcutKeys.length;i++){e._shutMethod("whenShortcut",i)}for(var i=0;i<e._whenXpressKeys.length;i++){e._shutMethod("whenXpress",i)}}if(t==="whenDown"){if(!n){for(var i=0;i<e._whenDownKeys.length;i++){if(r&&r!==e._whenDownKey[i]){continue}e._shutMethod("whenDown",i)}return this}for(var i=0;i<e._whenDownKeys.length;i++){if(n===e._whenDownKeys[i]){if(r&&r!==e._whenDownKey[i]){continue}e._shutMethod("whenDown",i)}}return this}if(t==="whenShortcut"){if(!n){for(var i=0;i<e._whenShortcutKeys.length;i++){if(r&&r!==e._whenShortcutKey[i]){continue}e._shutMethod("whenShortcut",i)}return this}for(var i=0;i<e._whenShortcutKeys.length;i++){if(n===e._whenShortcutKeys[i]){if(r&&r!==e._whenShortcutKey[i]){continue}e._shutMethod("whenShortcut",i)}return this}}if(t==="whenXpress"){if(!n){for(var i=0;i<e._whenXpressKeys.length;i++){if(r&&r!==e._whenXpressKey[i]){continue}e._shutMethod("whenXpress",i)}return this}for(var i=0;i<e._whenXpressKeys.length;i++){if(n===e._whenXpressKeys[i]){if(r&&r!==e._whenXpressKey[i]){continue}e._shutMethod("whenXpress",i)}return this}}return this},shutMethod:function(t,n){if(t==="whenDown"){e._whenDownKeys.splice(n,1);e._whenDownCallback.splice(n,1);e._whenDownContext.splice(n,1);e._whenDownCondition.splice(n,1);e._whenDownKey.splice(n,1)}if(t==="whenShortcut"){e._whenShortcutKeys.splice(n,1);e._whenShortcutCallback.splice(n,1);e._whenShortcutContext.splice(n,1);e._whenShortcutCondition.splice(n,1);e._whenShortcutKey.splice(n,1)}if(t==="whenXpress"){e._whenXpressKeys.splice(n,1);e._whenXpressCallback.splice(n,1);e._whenXpressN.splice(n,1);e._whenXpressContext.splice(n,1);e._whenXpressMilliseconds.splice(n,1);e._whenXpressListening.splice(n,1);e._whenXpressTrigger.splice(n,1);e._whenXpressCondition.splice(n,1);e._whenXpressKey.splice(n,1)}return this},countKeys:function(){return this._count},getKeys:function(){var t=[];for(var n in e._down){if(this._down.hasOwnProperty(n)){t.push(+n)}}return t},format:function(t){var n=[];if(this.isInteger(t)){n.push(t)}if(this.isString(t)){if(t.indexOf("+")===-1){n.push(e.strToKeyCode(t.trim()))}if(t.indexOf("+")!==-1){var r=t.split("+"),i=r.length;for(var s=0;s<i;s++){if(r[s]){n.push(e.strToKeyCode(r[s].trim()))}}}}if(this.isArray(t)){var o=t.length;for(var s=0;s<o;s++){if(this.isString(t[s])){n.push(e.strToKeyCode(t[s].trim()))}if(this.isInteger(t[s])){n.push(t[s])}if(this.isArray(t[s])){n.push(this.format(t[s]))}}}return n},strToKeyCode:function(t){if(!e.isString(t)){return false}var t=t.toLowerCase();for(var n=0;n<this._keysAsStringLength;n++){if(this._keysAsString[n]===t){return this._keysAsKeyCode[n]}}return false},compare:function(e,t){if(!this.isArray(e)||!this.isArray(t)){return false}if(e.length!==t.length){return false}var n=e.sort().join(","),r=t.sort().join(",");return n===r},isFunction:function(e){return Object.prototype.toString.call(e)==="[object Function]"},isArray:function(e){return Object.prototype.toString.call(e)==="[object Array]"},isBool:function(e){return Object.prototype.toString.call(e)==="[object Boolean]"},isObject:function(e){return Object.prototype.toString.call(e)==="[object Object]"},isInteger:function(e){return Object.prototype.toString.call(e)==="[object Number]"&&e%1===0},isUndefined:function(e){return Object.prototype.toString.call(e)==="[object Undefined]"},isString:function(e){return Object.prototype.toString.call(e)==="[object String]"}};blueprint._().listen(window.document);window.kDown=blueprint})(window)