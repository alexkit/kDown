/**
 * kDown 1.0.0
 * @author Alex Duloz ~ @alexduloz
 * MIT license
 *
 * Documentation intended for Closure Compiler
 * https://developers.google.com/closure/compiler/docs/js-for-compiler
 */
!function(){if(window.addEventListener){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var a=blueprint={_:function(){return this._ignoreInput=!1,this._cmdOrCtrl=!0,this._logKeyCodes=!1,this._preventDefault=!0,this._whenDownKeys=[],this._whenDownCallback=[],this._whenDownContext=[],this._whenShortcutKeys=[],this._whenShortcutCallback=[],this._whenShortcutContext=[],this._event,this._down={},this._count=0,this._keysAsString=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12","left","up","right","down","arrayleft","arrayup","arrayright","arraydown","alt","altkey","ctrl","ctrlkey","shift","shiftkey","meta","metakey","cmd","cmdkey","backspace","del","delete","end","enter","escape","esc","home","insert","pageup","pagedown","tab","space"],this._keysAsStringLength=this._keysAsString.length,this._keysAsKeyCode=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,48,49,50,51,52,53,54,55,56,57,112,113,114,115,116,117,118,119,120,121,122,123,37,38,39,40,37,38,39,40,18,18,17,17,16,16,[224,17,91,93],[224,17,91,93],[224,17,91,93],[224,17,91,93],8,8,46,35,13,27,27,36,45,33,34,9,32],this._keysAsKeyCodeLength=this._keysAsKeyCode.length,this._keyUpHandler=function(b){if(a._ignoreInput!==!0||"INPUT"!==b.target.tagName&&"TEXTAREA"!==b.target.tagName){if(a._event=b,b.metaKey)return a._down={},a._count=0,void 0;delete a._down[b.which],a._count--,a._count<0&&(a._count=0)}},this._keyDownHandler=function(b){if(a._logKeyCodes===!0&&console.log(b.which),a._ignoreInput!==!0||"INPUT"!==b.target.tagName&&"TEXTAREA"!==b.target.tagName){a._event=b;var c=a._whenShortcutKeys.length;if(c>0)for(var d=0;c>d;d++)if(a.isShortcut(a._whenShortcutKeys[d])){var e=!0;if(a._whenShortcutContext[d]){var f=a._whenShortcutContext[d].length;e=!1;for(var g=0;f>g;g++)if(a._whenShortcutContext[d][g]&&1===a._whenShortcutContext[d][g].nodeType)if(null===b.target.getAttribute("data-whenshortcut-context-"+d)||+b.target.getAttribute("data-whenshortcut-context-"+d)!==g){if(e===!0)continue}else e=!0}e===!0&&a.isFunction(a._whenShortcutCallback[d])&&a._whenShortcutCallback[d](a._event)}if(b.metaKey)return a._down={},a._count=0,void 0;a._down[b.which]||a._count++,a._down[b.which]=!0;var h=a._whenDownKeys.length;if(h>0)for(var d=0;h>d;d++)if(a.isDown(a._whenDownKeys[d])){var e=!0;if(a._whenDownContext[d]){var f=a._whenDownContext[d].length;e=!1;for(var g=0;f>g;g++)if(a._whenDownContext[d][g]&&1===a._whenDownContext[d][g].nodeType)if(null===b.target.getAttribute("data-whendown-context-"+d)||+b.target.getAttribute("data-whendown-context-"+d)!==g){if(e===!0)continue}else e=!0}e===!0&&a.isFunction(a._whenDownCallback[d])&&a._whenDownCallback[d](a._event)}}},this},ignoreInput:function(a){return this._ignoreInput=this.isBool(a)?a:!1,this},cmdOrCtrl:function(a){return this._cmdOrCtrl=this.isBool(a)?a:!0,this},logKeyCodes:function(a){return this._logKeyCodes=this.isBool(a)?a:!1,this},preventDefault:function(a){return this._preventDefault=this.isBool(a)?a:!0,this},config:function(a){return this.isObject(a)?(this.isBool(a.ignoreInput)&&(this._ignoreInput=a.ignoreInput),this.isBool(a.cmdOrCtrl)&&(this._cmdOrCtrl=a.cmdOrCtrl),this.isBool(a.logKeyCodes)&&(this._logKeyCodes=a.logKeyCodes),this.isBool(a.preventDefault)&&(this._preventDefault=a.preventDefault),this):void 0},listen:function(b){return b.addEventListener("keyup",a._keyUpHandler,!0),b.addEventListener("keydown",a._keyDownHandler,!0),this},remove:function(b){return b.removeEventListener("keyup",a._keyUpHandler,!0),b.removeEventListener("keydown",a._keyDownHandler,!0),this},isShortcut:function(b,c){var c=c||a._event,d=this.format(b);if(a.isUndefined(c))return!1;var e=d.length;if(0===e)return!1;for(var f=0,h=0;e>h;h++)16===d[h]&&c.shiftKey?f++:18===d[h]&&c.altKey?f++:a._cmdOrCtrl===!0&&(17===d[h]||this.isArray(d[h])&&d[h].toString()===[224,17,91,93].toString())?(c.metaKey||c.ctrlKey)&&f++:a._cmdOrCtrl===!1&&17===d[h]?c.ctrlKey&&f++:a._cmdOrCtrl===!1&&this.isArray(d[h])&&d[h].toString()===[224,17,91,93].toString()?c.metaKey&&f++:(c.which===d[h]||this.isArray(d[h])&&-1!==d[h].indexOf(c.which))&&f++;return f===e},whenShortcut:function(a,b,c){if(this._whenShortcutKeys.push(a),this._whenShortcutCallback.push(b),c)for(var c="[object HTMLCollection]"!==toString.call(c)?new Array(c):c,d=this._whenShortcutKeys.length-1,e=c.length,f=0;e>f;f++)c[f]&&1===c[f].nodeType&&c[f].setAttribute("data-whenshortcut-context-"+d,f);return this._whenShortcutContext.push(c),this},isDown:function(b,c){var c=c||a._event,d=this.format(b),e=0,f=0,g=d.length;for(var h in a._down)if(a._down.hasOwnProperty(h)){for(var i=0;g>=i;i++)this.isArray(d[i])?-1!==d[i].indexOf(+h)&&f++:d[i]===+h&&f++;e++}return e===f&&g===f?(this._preventDefault===!0&&c.preventDefault,!0):!1},whenDown:function(a,b,c){if(this._whenDownKeys.push(a),this._whenDownCallback.push(b),c)for(var c="[object HTMLCollection]"!==toString.call(c)?new Array(c):c,d=this._whenDownKeys.length-1,e=c.length,f=0;e>f;f++)c[f]&&1===c[f].nodeType&&c[f].setAttribute("data-whendown-context-"+d,f);return this._whenDownContext.push(c),this},countKeys:function(){return this._count},getKeys:function(){var b=[];for(var c in a._down)this._down.hasOwnProperty(c)&&b.push(+c);return b},format:function(b){var c=[];if(this.isInteger(b)&&c.push(b),this.isString(b)&&(-1===b.indexOf("+")&&c.push(a.strToKeyCode(b.trim())),-1!==b.indexOf("+")))for(var d=b.split("+"),e=d.length,f=0;e>f;f++)d[f]&&c.push(a.strToKeyCode(d[f].trim()));if(this.isArray(b))for(var g=b.length,f=0;g>f;f++)this.isString(b[f])&&c.push(a.strToKeyCode(b[f].trim())),this.isInteger(b[f])&&c.push(b[f]),this.isArray(b[f])&&c.push(this.format(b[f]));return c},strToKeyCode:function(b){if(!a.isString(b))return!1;for(var b=b.toLowerCase(),c=0;c<this._keysAsStringLength;c++)if(this._keysAsString[c]===b)return this._keysAsKeyCode[c];return!1},compare:function(a,b){if(!this.isArray(a)||!this.isArray(b))return!1;if(a.length!==b.length)return!1;var c=a.sort().join(","),d=b.sort().join(",");return c===d},isFunction:function(a){return"[object Function]"===Object.prototype.toString.call(a)},isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},isBool:function(a){return"[object Boolean]"===Object.prototype.toString.call(a)},isObject:function(a){return"[object Object]"===Object.prototype.toString.call(a)},isInteger:function(a){return"[object Number]"===Object.prototype.toString.call(a)&&0===a%1},isUndefined:function(a){return"[object Undefined]"===Object.prototype.toString.call(a)},isString:function(a){return"[object String]"===Object.prototype.toString.call(a)}};blueprint._().listen(window.document),window.kDown=blueprint}}(window);